{"ast":null,"code":"import{useContext,useEffect,useState}from\"react\";import{UserContext}from\"./UserContext\";import axios from'axios';import mondaySdk from\"monday-sdk-js\";import{Navigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Main(){const{setUserToken,userToken}=useContext(UserContext);let columnIDs=[];const fetchInvoices=async()=>{try{const response=await fetch(\"https://i9j279set4.execute-api.us-east-1.amazonaws.com/prod/invoice\");const data=await response.json();// console.log(data.invoices);\nconst Invoices=data.invoices;Invoices.forEach(async invoice=>{//board_id:1816973150\nconst columnValues=[];columnIDs.forEach(_ref=>{let{id,columnName}=_ref;columnValues.push(\"\\\\\\\"\".concat(id,\"\\\\\\\":\\\\\\\"\").concat(invoice[columnName.toLowerCase().replace(/\\s/g,'')],\"\\\\\\\"\"));});const columnValuesString=\"{\".concat(columnValues.join(','),\"}\");const query=\"mutation {\\n              create_item(\\n                board_id: 1816973150,\\n                \\n                item_name: \\\"Invoices\\\",\\n               column_values: \\\"\".concat(columnValuesString,\"\\\"\\n              ) {\\n                id\\n              }\\n            }\");try{const response=await fetch(\"https://api.monday.com/v2\",{method:\"post\",headers:{\"Content-Type\":\"application/json\",'Authorization':\"\".concat(userToken)},body:JSON.stringify({query:query})});const res=await response.json();// console.log(res);\n}catch(error){console.error(\"Error creating invoices\",error);}});window.alert('Invoices imported successfully!');}catch(error){console.error(\"Error fetching invoices:\",error);window.alert('Failed to import invoices. Please try again.');};};const createColumns=async()=>{const columnsToCreate=['Invoice Number','Reference','Status','Amount Due'];let createdColumnsCount=0;let columnsExist=false;console.log(userToken);try{const response=await fetch(\"https://api.monday.com/v2\",{method:'post',headers:{'Content-Type':'application/json','Authorization':\"\".concat(userToken)},body:JSON.stringify({query:\"\\n                {\\n                  boards(ids: 1816973150) {\\n                    columns {\\n                      id\\n                      title\\n                    }\\n                  }\\n                }\\n              \"})});const res=await response.json();const existingColumns=res.data.boards[0].columns.map(column=>column.title);for(const columnName of columnsToCreate){if(!existingColumns.includes(columnName)){const query=\"\\n                mutation {\\n                  create_column (\\n                    board_id: 1816973150,\\n                    title: \\\"\".concat(columnName,\"\\\",\\n                    column_type: text\\n                  ) {\\n                    id\\n                  }\\n                }\\n              \");try{const response=await fetch(\"https://api.monday.com/v2\",{method:'post',headers:{'Content-Type':'application/json','Authorization':\"\".concat(userToken)},body:JSON.stringify({'query':query})});const res=await response.json();const{id}=res.data.create_column;// console.log(`Created column '${columnName}':`, id);\ncolumnIDs.push({columnName,id});createdColumnsCount++;if(createdColumnsCount===columnsToCreate.length){window.alert('Columns created successfully.');}}catch(error){console.error(\"Error creating column '\".concat(columnName,\"':\"),error);}}else{// console.log(`Column '${columnName}' already exists.`);\ncolumnsExist=true;}}if(columnsExist){window.alert('Columns already exist.');}}catch(error){console.error('Error fetching columns:',error);window.alert('Failed to create columns. Please try again.');}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"nav\",{class:\"navbar navbar-expand-md   pt-5 pb-3  mb-5\",children:/*#__PURE__*/_jsxs(\"div\",{class:\"container-xxl\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"./favicon.ico\",alt:\"Logo\",className:\" me-2\"}),/*#__PURE__*/_jsx(\"span\",{class:\"text-dark fs-4 fw-bold\",children:\"Xero Integration\"}),/*#__PURE__*/_jsx(\"div\",{class:\"collapse navbar-collapse justify-content-end align-center \",id:\"main-nav\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"container  d-grid align-items-center\",style:{height:\" 60vh\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"row justify-content-center align-items-center \",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-8 col-md-6 mb-3\",children:/*#__PURE__*/_jsx(\"div\",{class:\"card justify-content-center align-items-center d-grid border-0 shadow\",style:{width:'18 rem',height:'300px'},children:/*#__PURE__*/_jsxs(\"div\",{class:\"card-body \",children:[/*#__PURE__*/_jsx(\"h2\",{class:\"fw-bold mb-3 card-title \",children:\"Fetch your Invoices\"}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchInvoices,className:\" btn btn-primary\",children:\"Import Invoices\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-8 col-md-6 mb-3\",children:/*#__PURE__*/_jsx(\"div\",{class:\"card justify-content-center align-items-center d-grid border-0 shadow\",style:{width:'18 rem',height:'300px'},children:/*#__PURE__*/_jsxs(\"div\",{class:\"card-body \",children:[/*#__PURE__*/_jsx(\"h2\",{class:\"fw-bold mb-3 card-title \",children:\"Create columns on monday\"}),/*#__PURE__*/_jsx(\"button\",{onClick:createColumns,className:\" btn btn-primary\",children:\"Create Columns\"})]})})})]})})]});}","map":{"version":3,"names":["useContext","useEffect","useState","UserContext","axios","mondaySdk","Navigate","jsx","_jsx","jsxs","_jsxs","Main","setUserToken","userToken","columnIDs","fetchInvoices","response","fetch","data","json","Invoices","invoices","forEach","invoice","columnValues","_ref","id","columnName","push","concat","toLowerCase","replace","columnValuesString","join","query","method","headers","body","JSON","stringify","res","error","console","window","alert","createColumns","columnsToCreate","createdColumnsCount","columnsExist","log","existingColumns","boards","columns","map","column","title","includes","create_column","length","children","class","src","alt","className","style","height","width","onClick"],"sources":["/home/hp/xero/client/src/pages/Main.js"],"sourcesContent":["import {useContext, useEffect, useState} from \"react\";\nimport {UserContext} from \"./UserContext\";\nimport axios from 'axios';\nimport mondaySdk from \"monday-sdk-js\";\nimport {Navigate} from \"react-router-dom\";\n\nexport default function Main() {\n    const {setUserToken,userToken} = useContext(UserContext);\n    let columnIDs = [];\n    const fetchInvoices = async () => {\n\n        try {\n          const response = await fetch(`https://i9j279set4.execute-api.us-east-1.amazonaws.com/prod/invoice`)\n          const data = await response.json();\n    \n          // console.log(data.invoices);\n    \n          const Invoices = data.invoices;\n    \n          Invoices.forEach(async (invoice) => {\n            //board_id:1816973150\n            const columnValues = [];\n            columnIDs.forEach(({ id, columnName }) => {\n              columnValues.push(`\\\\\"${id}\\\\\":\\\\\"${invoice[columnName.toLowerCase().replace(/\\s/g, '')]}\\\\\"`);\n            });\n    \n            const columnValuesString = `{${columnValues.join(',')}}`;\n    \n    \n            const query = `mutation {\n              create_item(\n                board_id: 1816973150,\n                \n                item_name: \"Invoices\",\n               column_values: \"${columnValuesString}\"\n              ) {\n                id\n              }\n            }`;\n            try {\n              const response = await fetch(\"https://api.monday.com/v2\", {\n                method: \"post\",\n                headers: {\n                  \"Content-Type\": \"application/json\",\n                  'Authorization': `${userToken}`,\n                },\n                body: JSON.stringify({\n                  query: query,\n                }),\n              })\n              const res = await response.json();\n              // console.log(res);\n            } catch (error) {\n              console.error(\"Error creating invoices\", error);\n            }\n          });\n          window.alert('Invoices imported successfully!');\n    \n        }\n        catch (error) {\n          console.error(\"Error fetching invoices:\", error);\n          window.alert('Failed to import invoices. Please try again.');\n        };\n      };\n    \n      const createColumns = async () => {\n        const columnsToCreate = ['Invoice Number', 'Reference', 'Status', 'Amount Due'];\n        let createdColumnsCount = 0;\n        let columnsExist = false;\n        console.log(userToken)\n        try {\n          const response = await fetch(\"https://api.monday.com/v2\", {\n            method: 'post',\n            headers: {\n              'Content-Type': 'application/json',\n              'Authorization': `${userToken}`,\n            },\n            body: JSON.stringify({\n              query: `\n                {\n                  boards(ids: 1816973150) {\n                    columns {\n                      id\n                      title\n                    }\n                  }\n                }\n              `,\n            }),\n          });\n          const res = await response.json();\n    \n          const existingColumns = res.data.boards[0].columns.map(column => column.title);\n    \n          for (const columnName of columnsToCreate) {\n            if (!existingColumns.includes(columnName)) {\n              const query = `\n                mutation {\n                  create_column (\n                    board_id: 1816973150,\n                    title: \"${columnName}\",\n                    column_type: text\n                  ) {\n                    id\n                  }\n                }\n              `;\n    \n              try {\n                const response = await fetch(\"https://api.monday.com/v2\", {\n                  method: 'post',\n                  headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `${userToken}`,\n                  },\n                  body: JSON.stringify({\n                    'query': query,\n                  }),\n                });\n                const res = await response.json();\n    \n                const { id } = res.data.create_column;\n                // console.log(`Created column '${columnName}':`, id);\n                columnIDs.push({ columnName, id });\n    \n                createdColumnsCount++;\n    \n                if (createdColumnsCount === columnsToCreate.length) {\n                  window.alert('Columns created successfully.');\n                }\n              } catch (error) {\n                console.error(`Error creating column '${columnName}':`, error);\n              }\n            } else {\n              // console.log(`Column '${columnName}' already exists.`);\n              columnsExist = true;\n            }\n          }\n    \n          if (columnsExist) {\n            window.alert('Columns already exist.');\n          }\n        } catch (error) {\n          console.error('Error fetching columns:', error);\n          window.alert('Failed to create columns. Please try again.');\n        }\n      };\n    \n  return (\n    <div>\n         <nav class=\"navbar navbar-expand-md   pt-5 pb-3  mb-5\">\n            <div class=\"container-xxl\">\n              <img\n                src=\"./favicon.ico\"\n                alt=\"Logo\"\n                className=\" me-2\"\n              />\n              <span class=\"text-dark fs-4 fw-bold\">Xero Integration</span>\n\n              <div\n                class=\"collapse navbar-collapse justify-content-end align-center \"\n                id=\"main-nav\"\n              >\n\n              </div>\n            </div>\n          </nav>\n\n          <div className=\"container  d-grid align-items-center\" style={{ height: \" 60vh\" }}>\n            <div className=\"row justify-content-center align-items-center \">\n              <div className=\"col-8 col-md-6 mb-3\">\n                <div class=\"card justify-content-center align-items-center d-grid border-0 shadow\" style={{ width: '18 rem', height: '300px' }}>\n                  <div class=\"card-body \">\n                    <h2 class=\"fw-bold mb-3 card-title \">Fetch your Invoices</h2>\n                    <button onClick={fetchInvoices} className=\" btn btn-primary\">\n                      Import Invoices\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <div className=\"col-8 col-md-6 mb-3\">\n                <div class=\"card justify-content-center align-items-center d-grid border-0 shadow\" style={{ width: '18 rem', height: '300px' }}>\n                  <div class=\"card-body \">\n                    <h2 class=\"fw-bold mb-3 card-title \">Create columns on monday</h2>\n                    <button onClick={createColumns} className=\" btn btn-primary\">\n                      Create Columns\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n    </div>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}